language: python
python:
    - "3.7"
env:
  - USE_BIKESHED_CACHE=true
  - USE_BIKESHED_CACHE=false
matrix:
  fast_finish: true
  allow_failures:
    - env: USE_BIKESHED_CACHE=false

sudo: false
cache: pip
before_install:
- chmod 755 ./.deploy-output.sh
install:
- pip install bikeshed
- |
  if "${USE_BIKESHED_CACHE}"; then
    # Use cached copy of bikeshed data files to give consistent builds
    rsync -aP --delete .spec-data/ "${VIRTUAL_ENV}"/lib/python3.7/site-packages/bikeshed/spec-data/
    rsync -aP --delete .bikeshed-include/ "${VIRTUAL_ENV}"/lib/python3.7/site-packages/bikeshed/boilerplate/webauthn/
  fi
script: 'bikeshed spec'
after_success:
- '[ "${TRAVIS_PULL_REQUEST}" = "false" ] && [ "${TRAVIS_BRANCH}" = "main" ] && ./.deploy-output.sh'
